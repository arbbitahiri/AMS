@page
@using AMS.Models
@model LoginModel
@{
    ViewData["Title"] = Resource.Login;
    Layout = "_Layout";
    ErrorVM error = (ErrorVM)ViewData["Error"] ?? new ErrorVM();
}

<form asp-page="Login" asp-route-returnUrl="@Model.ReturnUrl" class="form fv-plugins-bootstrap fv-plugins-framework" id="frm_Login" data-ajax="true" data-ajax-success="onSuccessLogin">
    <div class="mb-10" id="status"></div>

    @Html.AntiForgeryToken()
    <input asp-for="Input.returnUrl" type="hidden" />

    <div class="pb-5 pb-lg-15">
        <h3 class="font-weight-bolder text-dark font-size-h2 font-size-h1-lg">@Resource.Login</h3>
        <div class="text-muted font-weight-bold font-size-h4">@Resource.LoginToStart</div>
    </div>
    <div class="form-group fv-plugins-icon-container">
        <label class="font-size-h6 font-weight-bolder text-dark">@Resource.Email</label>
        <input asp-for="Input.Email" class="form-control form-control-solid h-auto py-7 px-6 rounded-lg border-0" type="text" autocomplete="off">
        <span asp-validation-for="Input.Email" class="text-danger"></span>
    </div>
    <div class="form-group fv-plugins-icon-container">
        <div class="d-flex justify-content-between mt-n5">
            <label class="font-size-h6 font-weight-bolder text-dark pt-5">@Resource.Password</label>
            <a href="/Identity/Account/ForgotPassword" class="text-primary font-size-h6 font-weight-bolder text-hover-primary pt-5">@Resource.ForgotPassword</a>
        </div>
        <input asp-for="Input.Password" class="form-control form-control-solid h-auto py-7 px-6 rounded-lg border-0" type="password" autocomplete="off" tabindex="0">
        <span asp-validation-for="Input.Password" class="text-danger"></span>
    </div>
    <div class="pb-lg-0 pb-5">
        <button type="submit" id="btn_SubmitLogin" class="btn btn-primary font-weight-bolder font-size-h6 px-8 py-4 my-3 mr-3" tabindex="2">@Resource.Login</button>
    </div>
</form>

@section Scripts{
    <script>
        $(document).ready(function() {
            $('#btn_SubmitLogin').on('click', function() {
                if ($('#frm_Login').valid()) {
                    $('#btn_SubmitLogin').addClass('spinner spinner-right spinner-white pr-15');
                    $('#btn_SubmitLogin').html('@Html.Raw(Resource.PleaseWait)');
                    $('#frm_Login').submit();
                    $('#btn_SubmitLogin')[0].disablde = true;
                }
            });
        });

        function onSuccessLogin(data) {
            show_loading();
            $('#btn_SubmitLogin')[0].disablde = true;
            if (data.status == ErrorStatus.SUCCESS) {
                $('#status').html('');
                window.location.href = '/Home/Index';
                hide_loading();
            } else {
                hide_loading();
                $('#btn_SubmitLogin').removeClass('spinner spinner-right spinner-white pr-15');
                $('#btn_SubmitLogin').html('@Html.Raw(Resource.Login)');
                $.post('/Identity/Account/Message?handler=Filter', {
                    Title: data.title,
                    Status: data.status,
                    Description: data.description,
                    __RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                }, function (data) {
                    $('#status').html(data);
                });
                $('#btn_SubmitLogin')[0].disablde = false;
            }
        }
    </script>
}
