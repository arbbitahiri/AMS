@using AMS.Models.Home
@model DeveloperVM

<div class="row gutter-b">
    <div class="col-md-4">
        <a class="card card-custom bg-dark bg-hover-state-dark bgi-no-repeat card-stretch gutter-b"
           style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-1.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <polygon points="0 0 24 0 24 24 0 24" />
                            <path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-dark font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.UsersCount
                </div>
                <div class="font-weight-bold text-inverse-dark font-size-sm ml-3">
                    @Resource.CountOfUsers
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4">
        <a class="card card-custom bg-primary bg-hover-state-primary bgi-no-repeat card-stretch gutter-b"
           style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-2.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M19,11 L21,11 C21.5522847,11 22,11.4477153 22,12 C22,12.5522847 21.5522847,13 21,13 L19,13 C18.4477153,13 18,12.5522847 18,12 C18,11.4477153 18.4477153,11 19,11 Z M3,11 L5,11 C5.55228475,11 6,11.4477153 6,12 C6,12.5522847 5.55228475,13 5,13 L3,13 C2.44771525,13 2,12.5522847 2,12 C2,11.4477153 2.44771525,11 3,11 Z M12,2 C12.5522847,2 13,2.44771525 13,3 L13,5 C13,5.55228475 12.5522847,6 12,6 C11.4477153,6 11,5.55228475 11,5 L11,3 C11,2.44771525 11.4477153,2 12,2 Z M12,18 C12.5522847,18 13,18.4477153 13,19 L13,21 C13,21.5522847 12.5522847,22 12,22 C11.4477153,22 11,21.5522847 11,21 L11,19 C11,18.4477153 11.4477153,18 12,18 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <circle fill="#000000" opacity="0.3" cx="12" cy="12" r="2" />
                            <path d="M12,17 C14.7614237,17 17,14.7614237 17,12 C17,9.23857625 14.7614237,7 12,7 C9.23857625,7 7,9.23857625 7,12 C7,14.7614237 9.23857625,17 12,17 Z M12,19 C8.13400675,19 5,15.8659932 5,12 C5,8.13400675 8.13400675,5 12,5 C15.8659932,5 19,8.13400675 19,12 C19,15.8659932 15.8659932,19 12,19 Z" fill="#000000" fill-rule="nonzero" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-dark font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.LogsCount
                </div>
                <div class="font-weight-bold text-inverse-dark font-size-sm ml-3">
                    @Resource.CountOfLogsToday
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4">
        <a class="card card-custom bg-success bg-hover-state-success bgi-no-repeat card-stretch gutter-b"
           style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-3.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M11,20 L11,17 C11,16.4477153 11.4477153,16 12,16 C12.5522847,16 13,16.4477153 13,17 L13,20 L15.5,20 C15.7761424,20 16,20.2238576 16,20.5 C16,20.7761424 15.7761424,21 15.5,21 L8.5,21 C8.22385763,21 8,20.7761424 8,20.5 C8,20.2238576 8.22385763,20 8.5,20 L11,20 Z" fill="#000000" opacity="0.3" />
                            <path d="M3,5 L21,5 C21.5522847,5 22,5.44771525 22,6 L22,16 C22,16.5522847 21.5522847,17 21,17 L3,17 C2.44771525,17 2,16.5522847 2,16 L2,6 C2,5.44771525 2.44771525,5 3,5 Z M4.5,8 C4.22385763,8 4,8.22385763 4,8.5 C4,8.77614237 4.22385763,9 4.5,9 L13.5,9 C13.7761424,9 14,8.77614237 14,8.5 C14,8.22385763 13.7761424,8 13.5,8 L4.5,8 Z M4.5,10 C4.22385763,10 4,10.2238576 4,10.5 C4,10.7761424 4.22385763,11 4.5,11 L7.5,11 C7.77614237,11 8,10.7761424 8,10.5 C8,10.2238576 7.77614237,10 7.5,10 L4.5,10 Z" fill="#000000" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-dark font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.WorkingSince
                </div>
                <div class="font-weight-bold text-inverse-dark font-size-sm ml-3">
                    @Resource.WorkingSince
                </div>
            </div>
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-6 gutter-b">
        <div class="card card-custom">
            <div class="card-header">
                <h4 class="card-title">@Resource.NumberOfUsersByGroups</h4>
            </div>
            <div class="card-body">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card card-custom">
            <div class="card-header">
                <h4 class="card-title">@Resource.ListOfLogs</h4>
            </div>
            <div class="card-body">
                <table id="tbl_logs" class="table table-striped table-bordered w-100 table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>@Resource.Action</th>
                            <th>@Resource.Description</th>
                            <th>@Resource.Date</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/amCharts/index.js" asp-append-version="true"></script>
    <script src="~/lib/amCharts/xy.js" asp-append-version="true"></script>
    <script src="~/lib/amCharts/Animated.js" asp-append-version="true"></script>
    <script src="~/lib/chartjs/chart.min.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function () {
            var chart_data = JSON.parse('@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.UserRoles))');
            render_chart(chart_data);
            render_table(@Json.Serialize(Model.Logs));
        });

        function render_chart(data) {
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(a => a.Role),
                    datasets: [{
                        label: '@Html.Raw("# " + Resource.NumberOfUsers)',
                        data: data.map(a => a.Count),
                        backgroundColor: [
                            '#007BFF',
                            '#28A745',
                            '#001F3F'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        },
                        font: {
                            size: 16
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                beginAtZero: true
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 90,
                                minRotation: 90
                            }
                        }
                    }
                }
            });
        }

        function render_table(data) {
            var rowCount = 1;
            $('#tbl_logs').DataTable({
                destroy: true,
                language: {
                    url: `/Culture/DataTable/${culture}.json`
                },
                deferRender: true,
                responsive: true,
                pageLength: 7,
                data: data,
                order: [[0, 'asc']],
                columnDefs: [
                    { targets: [0], width: '5%' },
                    { targets: [1], width: '25%' },
                    { targets: [2], width: '50%' }
                ],
                columns: [
                    {
                        data: function (data, type, row, meta) {
                            rowCount++;
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    { data: "action" },
                    {
                        data: function (row, type, set) {
                            var desc = '///';
                            if (row.description != null) {
                                if (row.description.length > 30) {
                                    desc = row.description.substring(0, 30) + '<span class="load-more" onclick="load_more(this)"><b>.. <a href="#' + rowCount + '">@Html.Raw(Resource.LookMore)</a></b></span><span class="d-none load-less-fst">' + row.description.substring(30) + '<span class="d-none load-less-snd" onclick="load_less(this)"><b> <a href="#' + rowCount + '">@Html.Raw(Resource.LookLess)</a></b></span></span>';
                                } else {
                                    desc = row.description ?? "///";
                                }
                            }
                            return desc;
                        }
                    },
                    {
                        data: function (row, type, set) {
                            return moment(row.insertedDate).format('DD/MM/YYYY HH:mm');
                        }
                    }
                ]
            });
        }

        function load_more(e) {
            $(e).parent().find('.load-less-fst').removeClass('d-none');
            $(e).parent().parent().find('.load-less-snd').removeClass('d-none');
            $(e).addClass('d-none');
        }

        function load_less(e) {
            $(e).addClass('d-none');
            $(e).parent().addClass('d-none');
            $(e).parent().parent().find('.load-more').removeClass('d-none');
        }
    </script>
}
