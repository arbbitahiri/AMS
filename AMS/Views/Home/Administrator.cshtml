@using AMS.Models.Home
@model AdministratorVM

<div class="row gutter-b">
    <div class="col-md-3">
        <a class="card card-custom bg-dark bg-hover-state-dark bgi-no-repeat card-stretch gutter-b"
            style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-4.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <polygon points="0 0 24 0 24 24 0 24" />
                            <path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-dark font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.StaffCount
                </div>
                <div class="font-weight-bold text-inverse-dark font-size-sm ml-3">
                    @Resource.NumberOfStaff
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a class="card card-custom bg-primary bg-hover-state-primary bgi-no-repeat card-stretch gutter-b"
           style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-1.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <polygon points="0 0 24 0 24 24 0 24" />
                            <path d="M5.85714286,2 L13.7364114,2 C14.0910962,2 14.4343066,2.12568431 14.7051108,2.35473959 L19.4686994,6.3839416 C19.8056532,6.66894833 20,7.08787823 20,7.52920201 L20,20.0833333 C20,21.8738751 19.9795521,22 18.1428571,22 L5.85714286,22 C4.02044787,22 4,21.8738751 4,20.0833333 L4,3.91666667 C4,2.12612489 4.02044787,2 5.85714286,2 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <rect fill="#000000" x="6" y="11" width="9" height="2" rx="1" />
                            <rect fill="#000000" x="6" y="15" width="5" height="2" rx="1" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-primary font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.DocumentsCount
                </div>
                <div class="font-weight-bold text-inverse-primary font-size-sm ml-3">
                    @Resource.NumberOfDocuments
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a class="card card-custom bg-success bg-hover-state-success bgi-no-repeat card-stretch gutter-b"
           style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-2.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M6,7 C7.1045695,7 8,6.1045695 8,5 C8,3.8954305 7.1045695,3 6,3 C4.8954305,3 4,3.8954305 4,5 C4,6.1045695 4.8954305,7 6,7 Z M6,9 C3.790861,9 2,7.209139 2,5 C2,2.790861 3.790861,1 6,1 C8.209139,1 10,2.790861 10,5 C10,7.209139 8.209139,9 6,9 Z" fill="#000000" fill-rule="nonzero" />
                            <path d="M7,11.4648712 L7,17 C7,18.1045695 7.8954305,19 9,19 L15,19 L15,21 L9,21 C6.790861,21 5,19.209139 5,17 L5,8 L5,7 L7,7 L7,8 C7,9.1045695 7.8954305,10 9,10 L15,10 L15,12 L9,12 C8.27142571,12 7.58834673,11.8052114 7,11.4648712 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <path d="M18,22 C19.1045695,22 20,21.1045695 20,20 C20,18.8954305 19.1045695,18 18,18 C16.8954305,18 16,18.8954305 16,20 C16,21.1045695 16.8954305,22 18,22 Z M18,24 C15.790861,24 14,22.209139 14,20 C14,17.790861 15.790861,16 18,16 C20.209139,16 22,17.790861 22,20 C22,22.209139 20.209139,24 18,24 Z" fill="#000000" fill-rule="nonzero" />
                            <path d="M18,13 C19.1045695,13 20,12.1045695 20,11 C20,9.8954305 19.1045695,9 18,9 C16.8954305,9 16,9.8954305 16,11 C16,12.1045695 16.8954305,13 18,13 Z M18,15 C15.790861,15 14,13.209139 14,11 C14,8.790861 15.790861,7 18,7 C20.209139,7 22,8.790861 22,11 C22,13.209139 20.209139,15 18,15 Z" fill="#000000" fill-rule="nonzero" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-success font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.AttendanceCount
                </div>
                <div class="font-weight-bold text-inverse-success font-size-sm ml-3">
                    @Resource.NumberOfAttendanceToday
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a class="card card-custom bg-info bg-hover-state-info bgi-no-repeat card-stretch gutter-b"
            style="background-position: right top; background-size: 25% auto; background-image: url(../../assets2/media/svg/shapes/abstract-3.svg);">
            <div class="card-body">
                <span class="svg-icon svg-icon-white svg-icon-3x">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M11,20 L11,17 C11,16.4477153 11.4477153,16 12,16 C12.5522847,16 13,16.4477153 13,17 L13,20 L15.5,20 C15.7761424,20 16,20.2238576 16,20.5 C16,20.7761424 15.7761424,21 15.5,21 L8.5,21 C8.22385763,21 8,20.7761424 8,20.5 C8,20.2238576 8.22385763,20 8.5,20 L11,20 Z" fill="#000000" opacity="0.3" />
                            <path d="M3,5 L21,5 C21.5522847,5 22,5.44771525 22,6 L22,16 C22,16.5522847 21.5522847,17 21,17 L3,17 C2.44771525,17 2,16.5522847 2,16 L2,6 C2,5.44771525 2.44771525,5 3,5 Z M4.5,8 C4.22385763,8 4,8.22385763 4,8.5 C4,8.77614237 4.22385763,9 4.5,9 L13.5,9 C13.7761424,9 14,8.77614237 14,8.5 C14,8.22385763 13.7761424,8 13.5,8 L4.5,8 Z M4.5,10 C4.22385763,10 4,10.2238576 4,10.5 C4,10.7761424 4.22385763,11 4.5,11 L7.5,11 C7.77614237,11 8,10.7761424 8,10.5 C8,10.2238576 7.77614237,10 7.5,10 L4.5,10 Z" fill="#000000" />
                        </g>
                    </svg>
                </span>
                <div class="text-inverse-success font-weight-bolder font-size-h4 mb-2 mt-5 ml-2">
                    @Model.WorkingSince
                </div>
                <div class="font-weight-bold text-inverse-success font-size-sm ml-3">
                    @Resource.WorkingSince
                </div>
            </div>
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card card-custom">
            <div class="card-header">
                <h4 class="card-title">@Resource.NumberOfAttendanceByDateForWeek</h4>
            </div>
            <div class="card-body">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card card-custom">
            <div class="card-header">
                <h4 class="card-title">@Resource.ListOfLogs</h4>
            </div>
            <div class="card-body">
                <table id="tbl_logs" class="table table-striped table-bordered w-100 table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>@Resource.Action</th>
                            <th>@Resource.Description</th>
                            <th>@Resource.Date</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/amCharts/index.js" asp-append-version="true"></script>
    <script src="~/lib/amCharts/xy.js" asp-append-version="true"></script>
    <script src="~/lib/amCharts/Animated.js" asp-append-version="true"></script>
    <script src="~/lib/chartjs/chart.min.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function () {
            var chart_data = JSON.parse('@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.WeekAttandance))');
            render_chart(chart_data);
            render_table(@Json.Serialize(Model.Logs));
        });

        function render_chart(data) {
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(a => a.Date),
                    datasets: [{
                        label: '@Html.Raw("# " + Resource.NumberOfAttendance)',
                        data: data.map(a => a.Count),
                        backgroundColor: [
                            '#26C6DA',
                            '#66BB6A',
                            '#FFA726',
                            '#EC407A',
                            '#AB47BC',
                            '#EF5350',
                            '#42A5F5',
                            '#536DFE',
                            '#B388FF'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        },
                        font: {
                            size: 16
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            });
        }

        function render_table(data) {
            var rowCount = 1;
            $('#tbl_logs').DataTable({
                destroy: true,
                language: {
                    url: `/Culture/DataTable/${culture}.json`
                },
                deferRender: true,
                responsive: true,
                pageLength: 7,
                data: data,
                order: [[0, 'asc']],
                columnDefs: [
                    { targets: [0], width: '5%' },
                    { targets: [1], width: '25%' },
                    { targets: [2], width: '50%' }
                ],
                columns: [
                    {
                        data: function (data, type, row, meta) {
                            rowCount++;
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    { data: "action" },
                    {
                        data: function (row, type, set) {
                            var desc = '///';
                            if (row.description != null) {
                                if (row.description.length > 30) {
                                    desc = row.description.substring(0, 30) + '<span class="load-more" onclick="load_more(this)"><b>.. <a href="#' + rowCount + '">@Html.Raw(Resource.LookMore)</a></b></span><span class="d-none load-less-fst">' + row.description.substring(30) + '<span class="d-none load-less-snd" onclick="load_less(this)"><b> <a href="#' + rowCount + '">@Html.Raw(Resource.LookLess)</a></b></span></span>';
                                } else {
                                    desc = row.description ?? "///";
                                }
                            }
                            return desc;
                        }
                    },
                    {
                        data: function (row, type, set) {
                            return moment(row.insertedDate).format('DD/MM/YYYY HH:mm');
                        }
                    }
                ]
            });
        }

        function load_more(e) {
            $(e).parent().find('.load-less-fst').removeClass('d-none');
            $(e).parent().parent().find('.load-less-snd').removeClass('d-none');
            $(e).addClass('d-none');
        }

        function load_less(e) {
            $(e).addClass('d-none');
            $(e).parent().addClass('d-none');
            $(e).parent().parent().find('.load-more').removeClass('d-none');
        }
    </script>
}
