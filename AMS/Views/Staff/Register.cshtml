@using AMS.Models.Staff
@model StaffPost
@inject IDDLRepository repo
@{
    ViewData["Title"] = Resource.FirstStepStaffRegistration;
    Layout = "~/Views/Staff/_Layout.cshtml";

    UserModel user = (UserModel)ViewData["User"];
}

<form asp-action='@(Model.MethodType == (int)MethodType.Post ? "Register" : "Edit")' asp-controller="Staff" id="frm_staff_registration" method="post">
    @Html.AntiForgeryToken()
    <input asp-for="StaffIde" type="hidden"/>
    <input asp-for="MethodType" type="hidden"/>
    <input asp-for="UserIde" type="hidden"/>

    <div class="row form-group">
        <div class="col-md-4">
            <label asp-for="PersonalNumber" class="required"></label>
            <input asp-for="PersonalNumber" type="text" autocomplete="off" class="form-control"/>
            <span asp-validation-for="PersonalNumber" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="Firstname" class="required"></label>
            <input asp-for="Firstname" type="text" autocapitalize="on" autocomplete="off" class="form-control"/>
            <span asp-validation-for="Firstname" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="Lastname" class="required"></label>
            <input asp-for="Lastname" type="text" autocapitalize="true" autocomplete="off" class="form-control"/>
            <span asp-validation-for="Lastname" class="text-danger"></span>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-md-4">
            <label asp-for="Email" class="required"></label>
            <input asp-for="Email" type="email" autocomplete="off" class="form-control"/>
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="PhoneNumber" class="required"></label>
            <input asp-for="PhoneNumber" type="text" autocomplete="off" class="form-control"/>
            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="BirthDate" class="required"></label>
            <div class="input-group date">
                <input asp-for="BirthDate" type="text" placeholder="dd/MM/yyyy" value="@(string.IsNullOrEmpty(Model.BirthDate) ? "" : Model.BirthDate)" class="form-control" autocomplete="off" />
                <div class="input-group-append">
                    <span class="input-group-text"><i class="la la-calendar"></i></span>
                </div>
            </div>
            <span asp-validation-for="BirthDate" class="text-danger"></span>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-md-4">
            <label asp-for="GenderId" class="required"></label>
            <select asp-for="GenderId" asp-items='await repo.Genders(user.Language)' class="form-control select2"></select>
            <span asp-validation-for="GenderId" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="CityId" class="required"></label>
            <select asp-for="CityId" asp-items='await repo.Cities(user.Language)' class="form-control select2"></select>
            <span asp-validation-for="CityId" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="CountryId" class="required"></label>
            <select asp-for="CountryId" asp-items='await repo.Countries(user.Language)' class="form-control select2"></select>
            <span asp-validation-for="CountryId" class="text-danger"></span>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-md-4">
            <label asp-for="Address" class="required"></label>
            <input asp-for="Address" type="text" autocomplete="off" class="form-control"/>
            <span asp-validation-for="Address" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="PostalCode"></label>
            <input asp-for="PostalCode" type="text" autocomplete="off" class="form-control"/>
            <span asp-validation-for="PostalCode" class="text-danger"></span>
        </div>
        <div class="col-md-4">
            <label asp-for="NewUser"></label><br />
            <input asp-for="NewUser" data-switch="true" style="cursor: pointer; width: 90px;"
                type="checkbox" id="ch_hasAccess" onchange="change_new_user(this)"
                data-bootstrap-switch data-off-color="warning" data-on-color="success" data-handle-width="90"
                data-on-text="@Html.Raw(Resource.Yes)" data-off-text="@Html.Raw(Resource.No)" />
            <span asp-validation-for="NewUser" class="text-danger"></span>
        </div>
    </div>

    <div class="row form-group for-user" style="@(Model.NewUser ? "" : "display: none;")">
        <div class="col-md-4">
            <label asp-for="Username" class="required"></label>
            <input asp-for="Username" type="text" autocomplete="off" class="form-control" />
            <span asp-validation-for="Username" class="text-danger"></span>
        </div>
    </div>

    <div class="d-flex justify-content-end border-top mt-5">
        <input type="button" value="@Resource.Continue" data-wizard-type="action-next" onclick="continue_form()" class="btn btn-primary font-weight-bolder text-uppercase mt-2 btn-lg" />
    </div>
</form>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("input[data-bootstrap-switch]").bootstrapSwitch();

            if (@Model.MethodType == MethodType.POST) {
                $('#f_tab').attr({ href: '', style: '' });
                $('#s_tab').attr({ href: '', style: 'cursor: default' });
                $('#t_tab').attr({ href: '', style: 'cursor: default' });
            } else {
                $('#f_tab').attr({ href: '@Url.Action("Register", "Staff")?ide=@Model.StaffIde&method=@Model.MethodType', style: "cursor: pointer" });
                $('#s_tab').attr({ href: '@Url.Action("Documents", "Staff")?ide=@Model.StaffIde&method=@Model.MethodType', style: "cursor: pointer" });
                $('#t_tab').attr({ href: '@Url.Action("Departments", "Staff")?ide=@Model.StaffIde&method=@Model.MethodType', style: "cursor: pointer" });
            }

            $.validator.setDefaults({ ignore: '' });
            var form = $('#frm_staff_registration');
            form.removeData('validator');
            form.removeData('unobtrusiveValidation');
            $.validator.unobtrusive.parse(form);

            $('#PhoneNumber').inputmask("mask", {
                mask: "+(999) 99 999-999",
                removeMaskOnSubmit: true,
                autoUnmask: true
            });

            $(".select2").select2({
                width: "100%",
                language: {
                    noResults: function () {
                        return '@Html.Raw(Resource.NoResultsFound)';
                    },
                }
            });

            $("#BirthDate").datepicker({
                language: cultureShort,
                rtl: KTUtil.isRTL(),
                todayBtn: "linked",
                todayHighlight: true,
                templates: arrows,
                autoclose: true,
                orientation: "bottom",
                format: 'dd/mm/yyyy'
            }).inputmask("mask", {
                mask: "99/99/9999",
                placeholder: "dd/MM/yyyy"
            });
        });

        function continue_form() {
            if($('#frm_staff_registration').valid()) {
                $('#frm_staff_registration').submit();
            }
        }

        function change_new_user(e) {
            if ($(e).is(':checked')) {
                $('.for-user').show(250);
            } else {
                $('.for-user').hide(250);
            }
        }
    </script>
}
